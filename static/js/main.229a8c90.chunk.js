(this.webpackJsonpraytracer=this.webpackJsonpraytracer||[]).push([[0],{25:function(t,e,n){t.exports=n(34)},34:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i),r=n(6),s=n.n(r),c=n(11),o=n(10),h=n(12);function u(){var t=Object(c.a)(["\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translateX(-50%) translateY(-50%);\n  /* height: 256px;\n  width: 256px; */\n  /* height: 512px;\n  width: 512px; */\n\n  border: 1px solid white;\n  /* background-color: red; */\n"]);return u=function(){return t},t}function l(){var t=Object(c.a)(["\n  display: inline-block;\n  height: 100vh !important;\n  width: 50% !important;\n"]);return l=function(){return t},t}function d(){var t=Object(c.a)(["\n  body {\n    height: 100vh;\n    width: 100vw;\n    margin: 0;\n    padding: 0;\n    background-color: black;\n    overflow:hidden !important;\n  }\n\n  .content {\n    position: absolute;\n    right: 0;\n    top: 0;\n    padding: 32px;\n    color: white;\n    font-size: 12px;\n  }\n"]);return d=function(){return t},t}var f=Object(h.a)(d()),v=Object(h.b)(o.a)(l()),y=h.b.div(u()),w=n(1),m=n(3),p=function(){function t(e,n,i){Object(w.a)(this,t),this.r=e,this.g=n,this.b=i}return Object(m.a)(t,[{key:"scalarMultiply",value:function(e){return new t(this.r*e,this.g*e,this.b*e)}},{key:"scalarDivide",value:function(e){return new t(this.r/e,this.g/e,this.b/e)}},{key:"add",value:function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b)}},{key:"multiply",value:function(e){return new t(this.r*e.r,this.g*e.g,this.b*e.b)}},{key:"clamp",value:function(e,n){return new t(Math.max(e,Math.min(this.r,n)),Math.max(e,Math.min(this.g,n)),Math.max(e,Math.min(this.b,n)))}},{key:"toDrawingColor",value:function(){var e=function(t){return t>1?1:t};return new t(Math.floor(255*e(this.r)),Math.floor(255*e(this.g)),Math.floor(255*e(this.b)))}}],[{key:"black",value:function(){return new t(0,0,0)}},{key:"blue",value:function(){return new t(0,.3,.6)}},{key:"white",value:function(){return new t(1,1,1)}},{key:"grey",value:function(){return new t(.5,.5,.5)}},{key:"background",value:function(){return t.black()}}]),t}(),b=function(){function t(e,n){Object(w.a)(this,t),this.start=e,this.dir=n}return Object(m.a)(t,[{key:"at",value:function(t){return this.start.add(this.dir.scalarMultiply(t))}}]),t}(),g=function(){function t(e,n,i){Object(w.a)(this,t),this.x=e,this.y=n,this.z=i}return Object(m.a)(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)}},{key:"dotProduct",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"crossProduct",value:function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}},{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"scalarMultiply",value:function(e){return new t(this.x*e,this.y*e,this.z*e)}},{key:"scalarDivide",value:function(e){return new t(this.x/e,this.y/e,this.z/e)}},{key:"length",value:function(){return Math.sqrt(this.dotProduct(this))}},{key:"distance",value:function(t){return t.subtract(this).length()}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}},{key:"normalize",value:function(){var e=this.length();return new t(this.x/e,this.y/e,this.z/e)}}]),t}(),k=function t(e,n,i,a){Object(w.a)(this,t),this.position=e,this.lookAt=n,this.fov=i,this.angle=Math.tan(.5*Math.PI*i/180),this.aspectRatio=a,this.forward=this.lookAt.subtract(this.position).normalize(),this.right=this.forward.crossProduct(new g(0,-1,0)).normalize(),this.up=this.forward.crossProduct(this.right).normalize()},M=function(){function t(e,n){Object(w.a)(this,t),this.position=e,this.color=n,this.attenuation=new g(0,0,1)}return Object(m.a)(t,[{key:"distance",value:function(t){return this.position.distance(t)}},{key:"intensityAt",value:function(t){var e=this.distance(t);return this.color.scalarDivide(this.attenuation.x+this.attenuation.y*e+this.attenuation.z*e*e)}}]),t}(),x=function t(e,n,i,a,r){Object(w.a)(this,t),this.isHit=e,this.position=n,this.normal=i,this.ray=a,this.material=r,this.distance=this.isHit?n.distance(a.start):Number.MAX_SAFE_INTEGER},z=function(){function t(e,n,i,a){Object(w.a)(this,t),this.name=e,this.position=n,this.color=i,this.material=a}return Object(m.a)(t,[{key:"intersect",value:function(t){var e=this.position.dotProduct(t.dir);if(e>0)return new x(!1);var n=this.position.dotProduct(t.start)/e,i=t.at(n);return new x(!0,i,this.position,t,this.material)}}]),t}(),j=function(){function t(e,n,i,a,r){Object(w.a)(this,t),this.name=e,this.position=n,this.size=i,this.color=a,this.material=r}return Object(m.a)(t,[{key:"intersect",value:function(t){var e,n,i,a=t.start.subtract(this.position),r=2*t.dir.dotProduct(a),s=t.dir.dotProduct(t.dir),c=a.dotProduct(a)-this.size*this.size,o=r*r-4*s*c;if(o<0)return new x(!1);if(0===o)n=-.5*r/s;else{var h=r>0?-.5*(r+Math.sqrt(o)):-.5*(r-Math.sqrt(o));n=h/s,i=c/h}if(n>i){var u=n;n=i,i=u}if(n<0&&(n=i)<0)return new x(!1);e=n;var l=t.at(e),d=l.subtract(this.position).scalarDivide(this.size);return new x(!0,l,d,t,this.material)}}]),t}(),E=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(w.a)(this,t),this.diffuse=e,this.specular=n,this.isSpecular=i,this.reflection=a,this.isTransparent=r,this.refraction=s},O=function t(){Object(w.a)(this,t),this.camera=new k(new g(3,-5,30),new g(0,0,0),60,1),this.lights=[new M(new g(-5,5,5),new p(75,75,75)),new M(new g(10,5,-5),new p(25,25,25))],this.objects=[new z("plane",new g(0,1,0),new p(.9,.9,.9),new E((function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?p.white():p.black()}))),new j("sphere",new g(0,1,-.25),2,new p(.4,1,.8),new E((function(){return new p(.4,1,.8)}),void 0,void 0,void 0,!0,1)),new j("sphere",new g(-4,.5,1.5),1.5,new p(.6,.2,0),new E((function(){return new p(.6,.2,0)}),new p(1,1,1),!0,.7))]},P=function(){function t(e,n,i){Object(w.a)(this,t),this.scene=new O,this.height=e,this.width=n,this.context=i,this.inside=!0}return Object(m.a)(t,[{key:"clamp",value:function(t,e,n){return Math.max(t,Math.min(e,n))}},{key:"spawnShadowRay",value:function(t){return this.intersectScene(t)}},{key:"calculateFresnelValue",value:function(t,e,n,i){var a=this.clamp(-1,1,e.dotProduct(t)),r=n,s=i;if(a>0){var c=r;r=s,s=c}var o=r/s*Math.sqrt(Math.max(0,1-a*a));if(o>=1)return 1;var h=Math.sqrt(Math.max(0,1-o*o)),u=(s*(a=Math.abs(a))-r*h)/(s*a+r*h),l=(r*a-s*h)/(r*a+s*h);return(u*u+l*l)/2}},{key:"getRefractedRay",value:function(t,e,n,i){var a=this.clamp(-1,1,e.dotProduct(t)),r=n,s=i,c=e;if(a<0)a=-a;else{c=c.scalarMultiply(-1);var o=r;r=s,s=o}var h=r/s,u=Math.sqrt(1-Math.pow(h,2)*(1-Math.pow(a,2)));return u<0?null:t.scalarMultiply(h).add(c.scalarMultiply(h*a-u)).normalize()}},{key:"calculateReflectedLight",value:function(t,e,n,i,a){var r=t.subtract(e.scalarMultiply(2*t.dotProduct(e))).normalize(),s=new b(n.add(e),r);return this.trace(s,i-1).scalarMultiply(a)}},{key:"calculateRefractedLight",value:function(t,e,n,i){var a=this.calculateFresnelValue(t,e,1.5,1),r=t.dotProduct(e)<0,s=e.scalarMultiply(1e-4),c=p.background();if(a<1){var o=this.getRefractedRay(t,e,1.5,1);if(null!==o){var h=r?n.add(s):n.subtract(s),u=new b(h,o);c=c.add(this.trace(u,i-1).scalarMultiply(a))}}var l=t.subtract(e.scalarMultiply(2*t.dotProduct(e))).normalize(),d=r?n.add(s):n.subtract(s),f=new b(d,l);return c=c.add(this.trace(f,i-1).scalarMultiply(1-a))}},{key:"illuminate",value:function(t,e,n,i,a){for(var r=new p(0,0,0),s=this.scene.lights,c=0;c<s.length;c+=1){var o=s[c].position.subtract(n).normalize(),h=new b(n.add(i.scalarMultiply(1e-5)),o),u=this.spawnShadowRay(h);if(null===u||!u.isHit&&u.distance>s[c].distance(n)&&o.dotProduct(i)>0){var l=s[c].intensityAt(n).multiply(e.diffuse(n).scalarMultiply(i.dotProduct(o)));r=r.add(l)}}return a>1&&e.isSpecular&&(r=r.add(this.calculateReflectedLight(t,i,n,a,e.reflection))),a>1&&e.isTransparent&&(r=r.add(this.calculateRefractedLight(t,i,n,a))),r}},{key:"intersectScene",value:function(t){for(var e=1/0,n=null,i=0;i<this.scene.objects.length;i+=1){var a=this.scene.objects[i].intersect(t);a.isHit&&a.distance<e&&(n=a,e=a.distance)}return n}},{key:"trace",value:function(t,e){var n=this.intersectScene(t);return n&&n.isHit?this.illuminate(n.ray.dir,n.material,n.position,n.normal,e):p.black()}},{key:"render",value:function(){for(var t=this,e=this.scene.camera,n=function(n,i){var a=((n+.5)*(1/t.width)*2-1)*e.angle*e.aspectRatio,r=(1-(i+.5)*(1/t.height)*2)*e.angle;return e.forward.add(e.right.scalarMultiply(a).add(e.up.scalarMultiply(r))).normalize()},i=0;i<this.width;i+=1)for(var a=0;a<this.height;a+=1){var r=new b(e.position,n(i,a)),s=this.trace(r,5).toDrawingColor();this.context.fillStyle="rgb(".concat(s.r,",").concat(s.g,", ").concat(s.b,")"),this.context.fillRect(i,a,1,1)}}}]),t}();var R=function(t){var e=t.canvasRef,n=Object(o.b)(),r=n.camera,s=n.scene,c=n.gl,h=Object(i.useRef)();return r.position.set(0,50,300),c.setSize(window.innerWidth/2,window.innerHeight),Object(i.useEffect)((function(){h.current,r.lookAt(0,0,0),s.children.forEach((function(t){return r.worldToLocal(t.position)}))}),[r,s]),Object(i.useEffect)((function(){var t=e.current,n=document.createElement("canvas");n.style.width="100%",n.width=2056,n.height=2056,t.appendChild(n);var i=n.getContext("2d");new P(n.width,n.height,i).render()}),[e,s]),a.a.createElement(a.a.Fragment,null,a.a.createElement("ambientLight",{attach:"light",intensity:.5}),a.a.createElement("pointLight",{ref:h,attach:"light",args:[16777215,1,600],position:[200,250,0]}),a.a.createElement("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],receiveShadow:!0},a.a.createElement("planeBufferGeometry",{attach:"geometry",args:[1e3,1e3]}),a.a.createElement("meshStandardMaterial",{attach:"material"})),a.a.createElement("mesh",{position:[0,70,0],castShadow:!0,receiveShadow:!0},a.a.createElement("sphereBufferGeometry",{attach:"geometry",args:[50,360,360]}),a.a.createElement("meshStandardMaterial",{attach:"material",color:11154176})),a.a.createElement("mesh",{position:[120,120,0],castShadow:!0,receiveShadow:!0},a.a.createElement("sphereBufferGeometry",{attach:"geometry",args:[50,360,360]}),a.a.createElement("meshStandardMaterial",{attach:"material",color:7864268})))};var S=function(){var t=a.a.useRef();return a.a.createElement("div",{style:{display:"inline-flex",height:"100%",width:"100%"}},a.a.createElement(v,null,a.a.createElement(R,{canvasRef:t})),a.a.createElement("div",{style:{width:"50%"}},a.a.createElement(y,{ref:t})))};s.a.render(a.a.createElement(a.a.Fragment,null,a.a.createElement(f,null),a.a.createElement(S,null)),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.229a8c90.chunk.js.map